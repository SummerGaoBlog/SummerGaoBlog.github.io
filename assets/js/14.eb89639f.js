(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{105:function(s,a,e){"use strict";e.r(a);var n=e(2),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"centos7-安装ejabberd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos7-安装ejabberd"}},[s._v("#")]),s._v(" CentOS7 安装ejabberd")]),s._v(" "),e("h2",{attrs:{id:"安装erlang-otp-22-0-可参考：centos-7-系统安装-erlang-otp-22-0-进行安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装erlang-otp-22-0-可参考：centos-7-系统安装-erlang-otp-22-0-进行安装"}},[s._v("#")]),s._v(" 安装Erlang/OTP 22.0 ,可参考："),e("a",{attrs:{href:"https://my.oschina.net/zhenggao/blog/3104375",target:"_blank",rel:"noopener noreferrer"}},[s._v("CentOS 7 系统安装 Erlang/OTP 22.0"),e("OutboundLink")],1),s._v(" 进行安装")]),s._v(" "),e("h2",{attrs:{id:"_1-下载源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载源码"}},[s._v("#")]),s._v(" 1.下载源码")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git://github.com/processone/ejabberd.git ejabberd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_2-安装所需依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装所需依赖"}},[s._v("#")]),s._v(" 2.安装所需依赖")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc-c++ \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kernel-devel \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" m4 \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ncurses-devel \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl-devel \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" unixODBC-devel \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libtool \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libtool-ltdl-devel \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" automake \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" autoconf \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" wx \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" fop \nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" expat-devel\nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libyaml-devel\nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dos2unix\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h2",{attrs:{id:"_3-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装"}},[s._v("#")]),s._v(" 3.安装")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ejabberd\n./autogen.sh\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./configure --enable-user"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root --enable-mysql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("[root@VM_0_2_centos ejabberd]# ./configure --enable-user=ejabberd --enable-mysql"),e("br"),s._v("\nchecking whether make sets $(MAKE)... yes"),e("br"),s._v("\nchecking for a BSD-compatible install... /usr/bin/install -c"),e("br"),s._v("\nchecking for a sed that does not truncate output... /usr/bin/sed"),e("br"),s._v("\nchecking for erl... /usr/local/bin/erl"),e("br"),s._v("\nchecking for erlc... /usr/local/bin/erlc"),e("br"),s._v("\nchecking for epmd... /usr/local/bin/epmd"),e("br"),s._v("\nchecking for erl... /usr/local/bin/erl"),e("br"),s._v("\nchecking for erlc... /usr/local/bin/erlc"),e("br"),s._v("\nchecking Erlang/OTP version... ok"),e("br"),s._v("\nchecking for Erlang/OTP root directory... /usr/local/lib/erlang"),e("br"),s._v("\nchecking for escript... /usr/local/lib/erlang/bin/escript"),e("br"),s._v("\nchecking for make... make"),e("br"),s._v("\nallow this system user to start ejabberd: ejabberd"),e("br"),s._v("\nconfigure: creating ./config.status"),e("br"),s._v("\nconfig.status: creating Makefile"),e("br"),s._v("\nconfig.status: creating vars.config"),e("br"),s._v("\nconfig.status: creating src/ejabberd.app.src")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("安装所创建的文件和目录为：")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("/usr/local/etc/ejabberd/")]),s._v(": Configuration directory:")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("ejabberd.yml")]),s._v(": ejabberd configuration file")]),s._v(" "),e("li",[e("code",[s._v("ejabberdctl.cfg")]),s._v(": Configuration file of the administration script")]),s._v(" "),e("li",[e("code",[s._v("inetrc")]),s._v(": Network DNS configuration file for Erlang")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("/usr/local/lib/ejabberd-19.09.65/")]),s._v(":")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("ebin/")]),s._v(": Erlang binary files (*.beam)")]),s._v(" "),e("li",[e("code",[s._v("include/")]),s._v(": Erlang header files (*.hrl)")]),s._v(" "),e("li",[e("code",[s._v("priv/")]),s._v(": Additional files required at runtime")]),s._v(" "),e("li",[e("code",[s._v("bin/")]),s._v(": Executable programs")]),s._v(" "),e("li",[e("code",[s._v("lib/")]),s._v(": Binary system libraries (*.so)")]),s._v(" "),e("li",[e("code",[s._v("msgs/")]),s._v(": Translation files (*.msgs)")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("/usr/local/sbin/ejabberdctl")]),s._v(": Administration script (see section "),e("a",{attrs:{href:"https://docs.ejabberd.im/admin/guide/managing/#ejabberdctl",target:"_blank",rel:"noopener noreferrer"}},[s._v("ejabberdctl"),e("OutboundLink")],1),s._v(")")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("/usr/local/share/doc/ejabberd/")]),s._v(": Documentation of ejabberd")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("/usr/local/var/lib/ejabberd/")]),s._v(": Spool directory:")]),s._v(" "),e("ul",[e("li",[e("code",[s._v(".erlang.cookie")]),s._v(": Erlang cookie file (see section "),e("a",{attrs:{href:"https://docs.ejabberd.im/admin/guide/security/#erlang-cookie",target:"_blank",rel:"noopener noreferrer"}},[s._v("cookie"),e("OutboundLink")],1),s._v(")")]),s._v(" "),e("li",[e("code",[s._v("acl.DCD, ...")]),s._v(": Mnesia database spool files (*.DCD, *.DCL, *.DAT)")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("/usr/local/var/log/ejabberd/")]),s._v(": Log directory (see section [logfiles]):")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("ejabberd.log")]),s._v(": ejabberd service log")]),s._v(" "),e("li",[e("code",[s._v("erlang.log")]),s._v(": Erlang/OTP system log")])])])]),s._v(" "),e("h2",{attrs:{id:"_4-启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-启动"}},[s._v("#")]),s._v(" 4.启动")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/sbin\nejabberdctl start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_5-查看服务状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看服务状态"}},[s._v("#")]),s._v(" 5.查看服务状态")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("ejabberdctl status\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_6-停止服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-停止服务"}},[s._v("#")]),s._v(" 6.停止服务")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("ejabberdctl stop\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_7-注册一个用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-注册一个用户"}},[s._v("#")]),s._v(" 7.注册一个用户")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("ejabberdctl register admin localhost "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_8-修改配置文件，设置admin可配置权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-修改配置文件，设置admin可配置权限"}},[s._v("#")]),s._v(" 8.修改配置文件，设置admin可配置权限")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("acl:\n  local:\n    user_regexp: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  loopback:\n    ip:\n      - "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8\n      - ::1/128\n  admin:\n    user:\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v("\n\naccess:\n  configure:\n    admin: allow\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h2",{attrs:{id:"_9-登录管理页面查看"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-登录管理页面查看"}},[s._v("#")]),s._v(" 9.登录管理页面查看")]),s._v(" "),e("p",[e("a",{attrs:{href:"http://www.nbiots.xyz:5280/admin/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:5280/admin/"),e("OutboundLink")],1),s._v(" 用户名及密码：admin 123456")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-1ccc8beee6e454d91aabcf235ba18d4fbaf.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-8bbbeb5b09cbfb106917d0b521e26bceca1.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"_10-客户端登录测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-客户端登录测试"}},[s._v("#")]),s._v(" 10.客户端登录测试")]),s._v(" "),e("p",[s._v("没有配置ttls证书，把starttls_required 设置成 false")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("listen:\n  -\n    port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5222")]),s._v("\n    ip: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"::"')]),s._v("\n    module: ejabberd_c2s\n    max_stanza_size: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n    shaper: c2s_shaper\n    access: c2s\n    starttls_required: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("Spark客户端登录测试")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-9832c015efbdc773f2f721609d0ef96f02b.png",alt:""}}),e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-895060a48c6f8604addec141a320418b760.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"_11-rest-api消息推送接口测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-rest-api消息推送接口测试"}},[s._v("#")]),s._v(" 11.Rest API消息推送接口测试")]),s._v(" "),e("p",[s._v("没有配置ttls证书，把tls 设置成 false")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("  -\n    port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5443")]),s._v("\n    ip: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"::"')]),s._v("\n    module: ejabberd_http\n    tls: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    request_handlers:\n      /admin: ejabberd_web_admin\n      /api: mod_http_api\n      /bosh: mod_bosh\n      /captcha: ejabberd_captcha\n      /upload: mod_http_upload\n      /ws: ejabberd_http_ws\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("在acl:节点下添加如下配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("acl:\n  local:\n    user_regexp: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  loopback:\n    ip:\n      - "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8\n      - ::1/128\n      - ::FFFF:49.234.110.112/16 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#改成自己主机的ip地址")]),s._v("\n  admin:\n    user:\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www.xxx.xyz"')]),s._v("\n    ip:\n      - ::FFFF:49.234.110.112/16 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#改成自己主机的ip地址")]),s._v("\naccess:\n  configure:\n    admin: allow\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("在api_permissions:节点下添加如下配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"API used from localhost allows all calls"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    who:\n      ip: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8\n    what:\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!stop"')]),s._v("\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!start"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("send_message接口测试")]),s._v(" "),e("p",[s._v("用postman给summergao用户推送消息")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-8f3c79d4d601ca11dabd6abfb9354d9af86.png",alt:""}})]),s._v(" "),e("p",[s._v("用Spark客户端接收消息")]),s._v(" "),e("h2",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")]),s._v(" "),e("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-3b696bcabc19e129a9a716330dae6a0d028.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"问题总结："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题总结："}},[s._v("#")]),s._v(" 问题总结：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),s._v(",\n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(",\n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AccessRules: Account does not have the right to perform the operation."')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("解决办法：")]),s._v(" "),e("p",[s._v("将我的ip / range添加到admin AND loopback块中：")]),s._v(" "),e("p",[s._v("追加：- ::FFFF:49.234.110.112/16")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("acl:\n  local:\n    user_regexp: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  loopback:\n    ip:\n      - "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.0/8\n      - ::1/128\n      - ::FFFF:127.0.0.1/128\n      - ::FFFF:49.234.110.112/16\n  admin:\n    user:\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin@localhost"')]),s._v("\n    ip:\n      - ::FFFF:49.234.110.112/16\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h2",{attrs:{id:"参考："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考："}},[s._v("#")]),s._v(" 参考：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://docs.ejabberd.im/developer/ejabberd-api/simple-configuration/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.ejabberd.im/developer/ejabberd-api/simple-configuration/"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("a",{attrs:{href:"https://docs.ejabberd.im/developer/ejabberd-api/admin-api/#send-message",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.ejabberd.im/developer/ejabberd-api/admin-api/#send-message"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("a",{attrs:{href:"https://stackoverflow.com/questions/58243535/ejabberd-accessrules-account-does-not-have-the-right-to-perform-the-operation?r=SearchResults",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/58243535/ejabberd-accessrules-account-does-not-have-the-right-to-perform-the-operation?r=SearchResults"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=t.exports}}]);